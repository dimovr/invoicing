<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faktura #{{.Invoice.DocumentNumber}}</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body class="bg-gray-100">

    <nav class="bg-gray-800 py-4">
        <div class="container mx-auto px-4 mx-auto flex justify-between items-center">
            <div class="flex space-x-4">
                <a href="/company" class="text-white hover:text-gray-300 {{if eq .active "company"}}font-bold border-b-2 border-white{{end}}">Company</a>
                <a href="/items" class="text-white hover:text-gray-300 {{if eq .active "items"}}font-bold border-b-2 border-white{{end}}">Items</a>
                <a href="/suppliers" class="text-white hover:text-gray-300 {{if eq .active "suppliers"}}font-bold border-b-2 border-white{{end}}">Suppliers</a>
                <a href="/invoices" class="text-white hover:text-gray-300 {{if eq .active "invoices"}}font-bold border-b-2 border-white{{end}}">Invoices</a>
            </div>
        </div>
    </nav>

    <div id="invoiceEditForm" class="container mx-auto px-4 py-4">
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <span class="block text-gray-700 mb-2"><b>Faktura #</b>{{.Invoice.DocumentNumber}}</span>
                <span class="block text-gray-700"><b>Dobavljaƒç:</b>  {{.Invoice.Supplier.Name}} - {{.Invoice.Supplier.Code}} / {{.Invoice.Supplier.Address}}</span>
                <span class="block text-gray-700 mb-2"><b>Datum:</b>{{.Invoice.Date.Format "02.01.2006"}}</span>
            </div>
            
            <div class="mb-6">
                <form id="addItemForm" hx-post="/invoices/{{.Invoice.ID}}/add-item" hx-target="#line-items" hx-swap="beforeend">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="item_id">Item</label>
                            <select id="item_id" name="item_id" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                                <option value="">-- Proizvod --</option>
                                {{range .Items}}
                                    <option value="{{.ID}}" data-price="{{.Price}}" data-tax-rate="{{.TaxRate}}">{{.Name}} - {{.Unit}}</option>
                                {{end}}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="buy_price">Buy Price</label>
                            <input type="number" id="buy_price" name="price" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" step="0.01" min="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="quantity">Quantity</label>
                            <input type="number" id="quantity" name="quantity" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="1" step="1" min="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="discount">Discount %</label>
                            <input type="number" id="discount" name="discount" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="0" step="0.01" min="0" max="100">
                        </div>
                        
                        <div class="mt-2 flex justify-end">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                                <i class="bi bi-plus"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="overflow-x-auto mb-6">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount %</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="line-items" class="bg-white divide-y divide-gray-200">
                        {{range .Invoice.LineItems}}
                            {{template "invoice-line-item.html" .}}
                        {{end}}
                    </tbody>
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td colspan="4" class="px-6 py-3 text-right font-bold">Subtotal:</td>
                            <td id="subtotal" class="px-6 py-3 text-left font-bold">$0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        
            <button id="complete-invoice"
             hx-post="/invoices/{{.Invoice.ID}}/complete"
             hx-target="closest div"
              hx-swap="outerHTML"
              class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                <i class="bi bi-check"></i>
            </button>
        </div>

    </div>
</body>
</html>